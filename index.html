<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskMaster - Reminders & To-Dos</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen font-sans selection:bg-indigo-100 selection:text-indigo-700">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Notification Component
        const NotificationToast = ({ message, onClose }) => (
            <div className="fixed top-4 right-4 z-50 animate-bounce-in">
                <div className="bg-indigo-600 text-white px-6 py-4 rounded-lg shadow-xl flex items-center gap-3 max-w-xs md:max-w-md">
                    <i data-lucide="bell-ring" className="w-6 h-6 animate-pulse"></i>
                    <div>
                        <h4 className="font-bold text-sm uppercase tracking-wide">Reminder</h4>
                        <p className="text-sm font-medium">{message}</p>
                    </div>
                    <button onClick={onClose} className="ml-auto hover:bg-indigo-700 p-1 rounded">
                        <i data-lucide="x" className="w-4 h-4"></i>
                    </button>
                </div>
            </div>
        );

        const App = () => {
            // State
            const [tasks, setTasks] = useState(() => {
                const saved = localStorage.getItem('github-todo-tasks');
                return saved ? JSON.parse(saved) : [];
            });
            const [inputValue, setInputValue] = useState('');
            const [dateValue, setDateValue] = useState('');
            const [activeNotification, setActiveNotification] = useState(null);
            const audioRef = useRef(null);

            // Load Lucide icons whenever DOM updates
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            });

            // Save to local storage
            useEffect(() => {
                localStorage.setItem('github-todo-tasks', JSON.stringify(tasks));
            }, [tasks]);

            // Check for reminders every 5 seconds
            useEffect(() => {
                const interval = setInterval(() => {
                    const now = new Date();
                    tasks.forEach(task => {
                        if (task.reminder && !task.completed && !task.notified) {
                            const taskDate = new Date(task.reminder);
                            // If current time is past reminder time (within a 1 minute window to prevent old spam)
                            if (now >= taskDate && (now - taskDate) < 60000) {
                                triggerNotification(task);
                            }
                        }
                    });
                }, 5000);

                return () => clearInterval(interval);
            }, [tasks]);

            // Request browser notification permission on load
            useEffect(() => {
                if ("Notification" in window) {
                    Notification.requestPermission();
                }
            }, []);

            const triggerNotification = (task) => {
                // 1. In-App Toast
                setActiveNotification(task.text);
                
                // 2. Play Sound (gentle beep)
                if(audioRef.current) {
                    audioRef.current.play().catch(e => console.log("Audio play failed", e));
                }

                // 3. Mark as notified so it doesn't ring again
                const updatedTasks = tasks.map(t => 
                    t.id === task.id ? { ...t, notified: true } : t
                );
                setTasks(updatedTasks);

                // 4. Browser Notification (if outside tab)
                if ("Notification" in window && Notification.permission === "granted") {
                    new Notification("Task Reminder", {
                        body: task.text,
                        icon: "https://cdn-icons-png.flaticon.com/512/7322/7322187.png" 
                    });
                }
            };

            const addTask = (e) => {
                e.preventDefault();
                if (!inputValue.trim()) return;

                const newTask = {
                    id: Date.now(),
                    text: inputValue,
                    completed: false,
                    reminder: dateValue ? new Date(dateValue).toISOString() : null,
                    notified: false,
                    createdAt: new Date().toISOString()
                };

                setTasks([newTask, ...tasks]);
                setInputValue('');
                setDateValue('');
            };

            const toggleTask = (id) => {
                setTasks(tasks.map(task => 
                    task.id === id ? { ...task, completed: !task.completed } : task
                ));
            };

            const deleteTask = (id) => {
                setTasks(tasks.filter(task => task.id !== id));
            };

            const formatFriendlyDate = (dateString) => {
                if (!dateString) return '';
                const date = new Date(dateString);
                return date.toLocaleString('en-US', { 
                    month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' 
                });
            };

            // Sort tasks: Pending first, then Completed. Within Pending: Soonest reminder first.
            const sortedTasks = [...tasks].sort((a, b) => {
                if (a.completed === b.completed) {
                    if (!a.reminder && !b.reminder) return b.id - a.id;
                    if (!a.reminder) return 1;
                    if (!b.reminder) return -1;
                    return new Date(a.reminder) - new Date(b.reminder);
                }
                return a.completed ? 1 : -1;
            });

            const stats = {
                total: tasks.length,
                completed: tasks.filter(t => t.completed).length,
                pending: tasks.filter(t => !t.completed).length
            };

            const progress = stats.total === 0 ? 0 : (stats.completed / stats.total) * 100;

            return (
                <div className="max-w-2xl mx-auto p-4 md:p-8">
                    {/* Hidden Audio for Alerts */}
                    <audio ref={audioRef} src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

                    {activeNotification && (
                        <NotificationToast 
                            message={activeNotification} 
                            onClose={() => setActiveNotification(null)} 
                        />
                    )}

                    {/* Header Section */}
                    <header className="mb-8">
                        <div className="flex justify-between items-end mb-4">
                            <div>
                                <h1 className="text-3xl md:text-4xl font-extrabold text-slate-900 tracking-tight">
                                    TaskFlow
                                </h1>
                                <p className="text-slate-500 mt-1">Manage your day, effectively.</p>
                            </div>
                            <div className="text-right">
                                <div className="text-sm font-semibold text-slate-600">
                                    {stats.completed}/{stats.total} Done
                                </div>
                            </div>
                        </div>
                        
                        {/* Progress Bar */}
                        <div className="h-2 bg-slate-200 rounded-full overflow-hidden">
                            <div 
                                className="h-full bg-indigo-500 transition-all duration-500 ease-out"
                                style={{ width: `${progress}%` }}
                            ></div>
                        </div>
                    </header>

                    {/* Input Section */}
                    <div className="glass-panel p-6 rounded-2xl shadow-lg border border-white mb-8">
                        <form onSubmit={addTask} className="flex flex-col gap-4">
                            <div>
                                <label className="block text-xs font-bold text-slate-500 uppercase mb-1 ml-1">Task Name</label>
                                <input
                                    type="text"
                                    value={inputValue}
                                    onChange={(e) => setInputValue(e.target.value)}
                                    placeholder="What needs to be done?"
                                    className="w-full bg-slate-50 border border-slate-200 text-slate-900 text-lg rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent block p-4 transition-all placeholder:text-slate-400"
                                />
                            </div>
                            
                            <div className="flex gap-2">
                                <div className="flex-1">
                                    <label className="block text-xs font-bold text-slate-500 uppercase mb-1 ml-1">Set Reminder (Optional)</label>
                                    <input
                                        type="datetime-local"
                                        value={dateValue}
                                        onChange={(e) => setDateValue(e.target.value)}
                                        className="w-full bg-slate-50 border border-slate-200 text-slate-700 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent block p-3"
                                    />
                                </div>
                                <div className="flex items-end">
                                    <button 
                                        type="submit" 
                                        disabled={!inputValue.trim()}
                                        className="bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-300 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-xl transition-colors flex items-center gap-2 shadow-lg shadow-indigo-200"
                                    >
                                        <i data-lucide="plus" className="w-5 h-5"></i>
                                        <span className="hidden md:inline">Add Task</span>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>

                    {/* Tasks List */}
                    <div className="space-y-3">
                        {tasks.length === 0 && (
                            <div className="text-center py-12 opacity-50">
                                <div className="bg-slate-200 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="check-circle-2" className="w-8 h-8 text-slate-400"></i>
                                </div>
                                <p className="text-lg font-medium text-slate-600">All caught up!</p>
                                <p className="text-sm text-slate-500">Add a task above to get started.</p>
                            </div>
                        )}

                        {sortedTasks.map(task => {
                            const isOverdue = task.reminder && new Date(task.reminder) < new Date() && !task.completed;
                            
                            return (
                                <div 
                                    key={task.id}
                                    className={`group relative p-4 rounded-xl border transition-all duration-200 hover:shadow-md ${
                                        task.completed 
                                            ? 'bg-slate-50 border-slate-100 opacity-60' 
                                            : 'bg-white border-slate-200'
                                    } ${isOverdue ? 'border-l-4 border-l-red-400' : ''}`}
                                >
                                    <div className="flex items-start gap-4">
                                        <button
                                            onClick={() => toggleTask(task.id)}
                                            className={`mt-1 flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors ${
                                                task.completed
                                                    ? 'bg-green-500 border-green-500 text-white'
                                                    : 'border-slate-300 hover:border-indigo-500 text-transparent'
                                            }`}
                                        >
                                            <i data-lucide="check" className="w-3 h-3 stroke-[4]"></i>
                                        </button>

                                        <div className="flex-1 min-w-0">
                                            <p className={`text-lg font-medium break-words ${
                                                task.completed ? 'line-through text-slate-400' : 'text-slate-800'
                                            }`}>
                                                {task.text}
                                            </p>
                                            
                                            {task.reminder && (
                                                <div className={`flex items-center gap-1 text-xs mt-1 font-medium ${
                                                    isOverdue ? 'text-red-500' : 'text-indigo-500'
                                                }`}>
                                                    <i data-lucide="clock" className="w-3 h-3"></i>
                                                    {formatFriendlyDate(task.reminder)}
                                                    {isOverdue && <span className="bg-red-100 text-red-600 px-1.5 py-0.5 rounded text-[10px] ml-2">OVERDUE</span>}
                                                </div>
                                            )}
                                        </div>

                                        <button 
                                            onClick={() => deleteTask(task.id)}
                                            className="opacity-0 group-hover:opacity-100 focus:opacity-100 p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all"
                                            aria-label="Delete task"
                                        >
                                            <i data-lucide="trash-2" className="w-5 h-5"></i>
                                        </button>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    
                    <footer className="mt-12 text-center text-slate-400 text-sm">
                        <p>Data is saved automatically to your browser.</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

